{"version":3,"file":"eomi.js","sources":["../src/conjugation.ts","../src/analyzer.ts"],"sourcesContent":["/* Utilities */\n\n/**\n * 초성, 중성, 종성에 해당하는 인덱스로 한글 음절을 조합한다.\n * @param x 초성 (0-18), 중성 (0-20), 종성 (0-27)으로 이루어진 정수 배열\n * @returns 조합된 한글 음절\n */\nfunction assembleSyllable(x: number[]): string {\n  const codepoint = x[0] * 588 + x[1] * 28 + x[2] + 0xac00;\n  return String.fromCharCode(codepoint);\n}\n\n/**\n * 문자열의 마지막 음절을 초성, 중성, 종성에 해당하는 인덱스로 분해한다.\n * @param x 분해하고자 하는 한글 음절로 끝나는 문자열.\n * @returns 초성 (0-18), 중성 (0-20), 종성 (0-27)으로 이루어진 정수 배열.\n */\nfunction disassembleSyllable(x: string): number[] {\n  const codepoint = x.charCodeAt(x.length - 1) - 0xac00;\n  const choseong = (codepoint / 588) | 0;\n  const jungseong = ((codepoint % 588) / 28) | 0;\n  const jongseong = codepoint % 28;\n  return [choseong, jungseong, jongseong];\n}\n\nconst BATCHIM_TABLE = \"ㄱㄲㄳㄴㄵㄶㄷㄹㄺㄻㄼㄽㄾㄿㅀㅁㅂㅄㅅㅆㅇㅈㅊㅋㅌㅍㅎ\";\nfunction getBatchim(x: string): string {\n  const idx = disassembleSyllable(x)[2];\n  return idx === 0 ? \"\" : BATCHIM_TABLE[idx - 1];\n}\n\nfunction startsWithSyllable(x: string): boolean {\n  return \"가\" <= x[0] && x[0] <= \"힣\";\n}\n\n/**\n * 두 한글 문자열을 결합한다.\n * @param x 결합할 앞 문자열.\n * @param y 결합할 뒤 문자열. 한글 음절로 시작하지 않을 수 있다.\n * @returns 결합된 문자열.\n */\nfunction concatHangeul(x: string, y: string): string {\n  const err = new Error(`Cannot concatenate '${x}' and '${y}'`);\n  if (!x || !y || startsWithSyllable(y)) return x + y;\n  const table = [\n    ,\n    ,\n    \"ㄱㄱ\",\n    \"ㄱㅅ\",\n    ,\n    \"ㄴㅈ\",\n    \"ㄴㅎ\",\n    ,\n    ,\n    \"ㄹㄱ\",\n    \"ㄹㅁ\",\n    \"ㄹㅂ\",\n    \"ㄹㅅ\",\n    \"ㄹㅌ\",\n    \"ㄹㅍ\",\n    \"ㄹㅎ\",\n    ,\n    ,\n    \"ㅂㅅ\",\n    ,\n    \"ㅅㅅ\",\n  ];\n  let newBatchim = table.indexOf(getBatchim(x) + y[0]);\n  if (newBatchim === -1) {\n    if (getBatchim(x)) throw err;\n    newBatchim = BATCHIM_TABLE.indexOf(y[0]) + 1;\n    if (newBatchim === 0) throw err;\n  }\n\n  let merged: number[] = disassembleSyllable(x);\n  merged[2] = newBatchim;\n  return x.slice(0, -1) + assembleSyllable(merged) + y.slice(1);\n}\n\n/* Main Classes */\n\n/** 한국어 용언 클래스. */\nclass Yongeon {\n  hada: string;\n  hae: string;\n  hani: string;\n  hamyeon: string;\n  batchim: string;\n\n  constructor(hada: string, hae?: string, hani?: string) {\n    this.hada = hada.slice(0, -1);\n    this.batchim = getBatchim(this.hada);\n\n    this.hae = hae || this.recoverHae();\n    this.hani = hani ? hani.slice(0, -1) : this.recoverHani();\n    this.hamyeon = this.batchim === \"ㄹ\" ? this.hada : this.hani;\n  }\n\n  /**\n   * 어미를 받아 활용합니다.\n   * 인수로는 어미 하나를 받거나 문자열 두 개를 받아 어미를 만듭니다.\n   */\n  _(eomi: Eomi | string, eomiAfterBatchim?: string): string {\n    if (!(eomi instanceof Eomi)) eomi = new Eomi(eomi, eomiAfterBatchim);\n    else if (eomiAfterBatchim != null)\n      throw Error(\n        \"If the first argument is a proper Eomi, only one argument should be given.\"\n      );\n\n    return eomi.after(this);\n  }\n\n  recoverHae(): string {\n    let jamos = disassembleSyllable(this.hada);\n    if (!this.batchim) {\n      if (jamos[1] === 0 || jamos[1] === 4) {\n        return this.hada; // ㅏ, ㅓ\n      } else if (jamos[1] === 18) {\n        jamos[1] = 4; // ㅡ -> ㅓ\n        return this.hada.slice(0, -1) + assembleSyllable(jamos);\n      }\n    }\n    return this.hada + (jamos[1] === 0 || jamos[1] === 8 ? \"아\" : \"어\"); // ㅏ, ㅗ\n  }\n\n  recoverHani(): string {\n    let jamos = disassembleSyllable(this.hada);\n    if (this.batchim === \"ㄹ\") {\n      // ㄹ 탈락\n      jamos[2] = 0;\n      return this.hada.slice(0, -1) + assembleSyllable(jamos);\n    }\n\n    const haeLast = this.hae.slice(-1);\n    if (\"아어\".indexOf(haeLast) !== -1) {\n      // 받침 있는 규칙 | ㄷ ㅅ 불규칙\n      return this.hae.slice(0, -1) + (this.batchim && \"으\");\n    } else if (\"와워\".indexOf(haeLast) !== -1) {\n      // ㅂ 불규칙\n      return this.hae.slice(0, -1) + \"우\";\n    } else if (this.batchim === \"ㅎ\") {\n      // ㅎ 불규칙\n      jamos[2] = 0;\n      return this.hada.slice(0, -1) + assembleSyllable(jamos);\n    }\n    return this.hada; // 받침 없는 규칙 | 르, 러, 우, 여 불규칙\n  }\n\n  valueOf(): string {\n    return this.hada + \"다\";\n  }\n}\n\nconst enum EomiType {\n  DIRECT = \"\",\n  A_EO = \"(아/어)\",\n  EU = \"(으)\",\n}\n\n/** 어미 활용을 구현한 클래스. */\nclass EomiUnit {\n  eomiType: EomiType;\n  body: string;\n  dropRieul: boolean;\n\n  constructor(eomi: string) {\n    const err = new Error(`Cannot parse given string ${eomi} to EomiUnit`);\n    if (eomi[0] === \"-\") eomi = eomi.slice(1);\n\n    const infTest = eomi.match(\n      /^[(]?([아-앟어-엏])(?:[/]([아-앟어-엏]))?[)]?(.*)$/\n    );\n    const seqTest = eomi.match(/^[(]?([으-읗])[)]?(.*)$/);\n    const siotTest = eomi.match(/^([ㅅㅆ].*)$/);\n    const batchimTest = eomi.match(/^([ㄱ-ㅎ].*)$/);\n\n    if (infTest !== null) {\n      const [, med1, med2, rest] = infTest;\n      if (med2 && getBatchim(med1) !== getBatchim(med2)) throw err;\n      this.body = getBatchim(med1) + rest;\n      this.eomiType = EomiType.A_EO;\n    } else if (seqTest !== null) {\n      const [, med, rest] = seqTest;\n      this.body = getBatchim(med) + rest;\n      this.eomiType = EomiType.EU;\n    } else if (siotTest !== null) {\n      this.body = siotTest[1];\n      this.eomiType = EomiType.A_EO;\n    } else if (batchimTest !== null) {\n      this.body = batchimTest[1];\n      this.eomiType = EomiType.EU;\n    } else {\n      this.body = eomi;\n      this.eomiType = EomiType.DIRECT;\n    }\n\n    if (startsWithSyllable(this.body)) {\n      const choseong = ((this.body.charCodeAt(0) - 0xac00) / 588) | 0;\n      this.dropRieul = [2, 9, 11].indexOf(choseong) !== -1; // [ㄴ, ㅅ, ㅇ]\n    } else {\n      this.dropRieul = \"ㄴㄹㅂ\".indexOf(this.body[0]) !== -1;\n    }\n  }\n\n  /** 용언을 받아 활용합니다. */\n  after(yongeon: Yongeon): string {\n    let stem: string = yongeon.hada;\n    if (this.eomiType === EomiType.A_EO) {\n      stem = yongeon.hae;\n    } else if (this.eomiType === EomiType.EU) {\n      stem = this.dropRieul ? yongeon.hani : yongeon.hamyeon;\n    } else if (this.dropRieul && yongeon.batchim === \"ㄹ\") {\n      stem = yongeon.hani;\n    }\n    return concatHangeul(stem, this.body);\n  }\n\n  valueOf(): string {\n    return \"-\" + this.eomiType + this.body;\n  }\n}\n\n/** 한국어 어미 클래스. */\nclass Eomi {\n  eomi: EomiUnit;\n  eomiAfterBatchim?: EomiUnit;\n  constructor(eomi: EomiUnit | string, eomiAfterBatchim?: EomiUnit | string) {\n    if (typeof eomi === \"string\") eomi = new EomiUnit(eomi);\n    if (typeof eomiAfterBatchim === \"string\")\n      eomiAfterBatchim = new EomiUnit(eomiAfterBatchim);\n    this.eomi = eomi;\n    this.eomiAfterBatchim = eomiAfterBatchim;\n  }\n\n  /** 용언을 받아 활용합니다. */\n  after(yongeon: Yongeon): string {\n    let eomi = this.eomi;\n    if (this.eomiAfterBatchim != null && yongeon.batchim) {\n      if (yongeon.batchim !== \"ㄹ\" || !eomi.dropRieul)\n        eomi = this.eomiAfterBatchim;\n    }\n    return eomi.after(yongeon);\n  }\n\n  valueOf(): string {\n    const after = this.eomiAfterBatchim;\n    return this.eomi + (after != null ? \"/\" + after : \"\");\n  }\n}\n\nexport { Yongeon, Eomi, EomiType };\n","import { Yongeon, Eomi, EomiType } from \"./conjugation\";\n\n/* Trie */\n\ntype TrieNode<T> = { values?: T[]; children?: Map<string, TrieNode<T>> };\nfunction _cloneNode<T>(node: TrieNode<T>): TrieNode<T> {\n  if (!node.children) return { values: node.values };\n  let children = new Map<string, TrieNode<T>>();\n  for (let [key, value] of node.children.entries()) {\n    children.set(key, _cloneNode(value));\n  }\n  return { values: node.values, children };\n}\n\nclass Trie<T> {\n  root: TrieNode<T>;\n  constructor() {\n    this.root = {};\n  }\n\n  clone(): Trie<T> {\n    let other = new Trie<T>();\n    other.root = _cloneNode(this.root);\n    return other;\n  }\n\n  get(key: string): T[] {\n    let node = this.root;\n    for (let k of key) {\n      if (!node.children) return [];\n      let child = node.children.get(k);\n      if (!child) return [];\n      node = child;\n    }\n    return node.values || [];\n  }\n\n  set(key: string, value: T): void {\n    let node = this.root;\n    for (let k of key) {\n      if (!node.children) node.children = new Map();\n      let child = node.children.get(k);\n      if (!child) {\n        child = {};\n        node.children.set(k, child);\n      }\n      node = child;\n    }\n    if (!node.values) node.values = [value];\n    else node.values.push(value);\n  }\n\n  /**\n   * Searches for all strings found in Trie that are the prefixes of `key`.\n   * @param key A string to search for prefixes\n   * @returns A list of pairs of values and the suffix remaining after the prefix.\n   */\n  allPrefixes(key: string): [T[], string][] {\n    let results: [T[], string][] = [];\n    let node = this.root;\n    for (let i = 0; i < key.length; i++) {\n      if (!node.children) break;\n      let child = node.children.get(key[i]);\n      if (!child) break;\n      if (child.values && child.values.length)\n        results.push([child.values, key.slice(i + 1)]);\n      node = child;\n    }\n    return results;\n  }\n}\n\n/* Analyzer */\n\n/**\n * 호환용 한글 자모 중 자음을 한글 자모 중 종성으로 변환합니다.\n * @param x 길이가 1인 문자열.\n * @returns 변환된 문자열. 해당되지 않으면 그대로 돌려받습니다.\n */\nfunction compatToJongseong(x: string) {\n  if (x < \"ㄱ\" || \"ㅎ\" < x) return x;\n  const skip = [\"ㄸ\", \"ㅃ\", \"ㅉ\"];\n  if (skip.indexOf(x[0]) !== -1) return x;\n\n  let codepoint = x.charCodeAt(0) - \"ㄱ\".charCodeAt(0);\n  skip.forEach((c) => (codepoint -= x > c ? 1 : 0));\n  return String.fromCharCode(codepoint + 0x11a8);\n}\n\n/**\n * 한글 문자열을 자모로 분리합니다.\n * @param x 한글 문자열. 음절 또는 자모로 구성됩니다.\n */\nfunction N(x: string) {\n  return x.split(\"\").map(compatToJongseong).join(\"\").normalize(\"NFD\");\n}\n\ntype YongeonForm = {\n  yongeon: Yongeon;\n  eomiType: EomiType | string; // workaround for const enum of another module\n  dropRieul?: boolean;\n};\ntype EomiRecord = { eomi: Eomi; eomiType: EomiType; dropRieul: boolean };\n\n/** 용언의 활용형을 어근과 어미로 분리하는 클래스. */\nclass Analyzer {\n  yongeons: Trie<YongeonForm>;\n  eomis: Map<string, EomiRecord[]>;\n\n  constructor(yongeons: Yongeon[], eomis: Eomi[]);\n  constructor(other: Analyzer);\n  constructor(yongeons: Yongeon[] | Analyzer, eomis: Eomi[] = []) {\n    if (yongeons instanceof Analyzer) {\n      this.yongeons = yongeons.yongeons.clone();\n      this.eomis = new Map(yongeons.eomis);\n    } else {\n      this.yongeons = new Trie();\n      yongeons.forEach((yongeon) => this.addYongeon(yongeon));\n\n      this.eomis = new Map();\n      eomis.forEach((eomi) => this.addEomi(eomi));\n    }\n  }\n\n  clone(): Analyzer {\n    return new Analyzer(this);\n  }\n\n  addYongeon(yongeon: Yongeon): void {\n    let dropRieul = yongeon.batchim === \"ㄹ\" ? false : undefined;\n    this.yongeons.set(N(yongeon.hada), {\n      yongeon,\n      eomiType: \"\",\n      dropRieul,\n    });\n    this.yongeons.set(N(yongeon.hae), { yongeon, eomiType: \"(아/어)\" });\n    this.yongeons.set(N(yongeon.hamyeon), {\n      yongeon,\n      eomiType: \"(으)\",\n      dropRieul,\n    });\n    if (yongeon.batchim === \"ㄹ\") {\n      this.yongeons.set(N(yongeon.hani), {\n        yongeon,\n        eomiType: \"\",\n        dropRieul: true,\n      });\n      this.yongeons.set(N(yongeon.hani), {\n        yongeon,\n        eomiType: \"(으)\",\n        dropRieul: true,\n      });\n    }\n  }\n\n  addEomi(eomi: Eomi): void {\n    this.addEomiUnit(N(eomi.eomi.body), {\n      eomi,\n      eomiType: eomi.eomi.eomiType,\n      dropRieul: eomi.eomi.dropRieul,\n    });\n    if (eomi.eomiAfterBatchim) {\n      this.addEomiUnit(N(eomi.eomiAfterBatchim.body), {\n        eomi,\n        eomiType: eomi.eomiAfterBatchim.eomiType,\n        dropRieul: eomi.eomiAfterBatchim.dropRieul,\n      });\n    }\n  }\n\n  addEomiUnit(key: string, value: EomiRecord): void {\n    let dest = this.eomis.get(key);\n    if (dest) dest.push(value);\n    else this.eomis.set(key, [value]);\n  }\n\n  /** 용언의 활용형을 분석해 어근 및 어미쌍의 배열을 내놓습니다. */\n  analyze(target: string): [Yongeon, Eomi][] {\n    let results: [Yongeon, Eomi][] = [];\n    for (let [forms, suffix] of this.yongeons.allPrefixes(N(target))) {\n      for (let { eomi, eomiType, dropRieul } of this.eomis.get(suffix) || []) {\n        for (let form of forms) {\n          if (eomiType !== form.eomiType) continue;\n          if (form.dropRieul != null && dropRieul !== form.dropRieul) continue;\n          results.push([form.yongeon, eomi]);\n        }\n      }\n    }\n    return results;\n  }\n}\n\nexport { Analyzer };\n"],"names":["assembleSyllable","x","String","fromCharCode","disassembleSyllable","codepoint","charCodeAt","length","getBatchim","idx","startsWithSyllable","Yongeon","EomiType","hada","hae","hani","this","hamyeon","batchim","slice","recoverHae","recoverHani","_","eomi","eomiAfterBatchim","Eomi","Error","after","jamos","haeLast","indexOf","valueOf","EomiUnit","eomiType","body","dropRieul","err","infTest","match","seqTest","siotTest","batchimTest","med1","med2","rest","A_EO","EU","DIRECT","choseong","yongeon","stem","y","newBatchim","merged","concatHangeul","_cloneNode","node","children","values","_step","Map","entries","_iterator","done","_step$value","value","set","Trie","root","clone","other","get","key","_step2","_iterator2","_createForOfIteratorHelperLoose","child","_step3","_iterator3","k","push","allPrefixes","results","i","compatToJongseong","skip","forEach","c","N","split","map","join","normalize","Analyzer","yongeons","eomis","_this","addYongeon","addEomi","undefined","addEomiUnit","dest","analyze","target","_step4","_iterator4","_step5","_step4$value","forms","_iterator5","_step6","_step5$value","_iterator6","form"],"mappings":"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"}